<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Modelling maturity &amp; sex with multiple stocks • gadget3</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<script src="../extra.js"></script><meta property="og:title" content="Modelling maturity &amp; sex with multiple stocks">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gadget3</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.12-1-999</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction-single-stock.html">Introduction to gadget3: A single stock model</a>
    </li>
    <li>
      <a href="../articles/incorporating-observation-data.html">Incorporating observation data into models</a>
    </li>
    <li>
      <a href="../articles/multiple-substocks.html">Modelling maturity &amp; sex with multiple stocks</a>
    </li>
    <li>
      <a href="../articles/model-customisation.html">Model customisation</a>
    </li>
    <li>
      <a href="../articles/random-effects.html">Spawning &amp; Random effects</a>
    </li>
    <li>
      <a href="../articles/model-debugging.html">Debugging a gadget3 model</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Advanced</li>
    <li>
      <a href="../articles/model-structure.html">Structure of a gadget3 model</a>
    </li>
    <li>
      <a href="../articles/writing_actions.html">Writing G3 Actions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/gadget-framework/gadget3/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Modelling maturity &amp; sex with multiple
stocks</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/gadget-framework/gadget3/blob/master/vignettes/multiple-substocks.Rmd" class="external-link"><code>vignettes/multiple-substocks.Rmd</code></a></small>
      <div class="hidden name"><code>multiple-substocks.Rmd</code></div>

    </div>

    
    
<style type="text/css">
/* https://bookdown.org/yihui/rmarkdown-cookbook/html-css.html */
.modelScript pre, .modelScript pre.sourceCode code {
  background-color: #f0f8ff !important;
}
</style>
<p>This vignette walks through a script that will generate a gadget3
model, explaining concepts along the way.</p>
<p>Code blocks that make up the gadget3 script are marked in blue, like
this:</p>
<div class="modelScript">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">### Modelling maturity &amp; sex with multiple stocks</span></span></code></pre></div>
</div>
<p>When combined they will form a full model, see <a href="#appendix-full-model-script">the appendix for the entire
script</a>.</p>
<div class="section level2">
<h2 id="stocks-substocks">Stocks &amp; substocks<a class="anchor" aria-label="anchor" href="#stocks-substocks"></a>
</h2>
<p>As mentioned before in
<code><a href="../articles/introduction-single-stock.html">vignette('introduction-single-stock')</a></code>, gadget3 stock
objects do not have to correspond 1:1 with a species.</p>
<p>We can have multiple stock objects representing the same species in a
different stage in their life-cycle, most commonly <code>mature</code>
and <code>immature</code> versions, <code>male</code> and
<code>female</code> versions, or all 4.</p>
<p>The set up is much the same as before, but major differences will be
highlighted.</p>
<p>Initial setup &amp; time-keeping is identical:</p>
<div class="modelScript">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gadget-framework.github.io/gadget3/">gadget3</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">actions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">area_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stock_areas.html">g3_areas</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'IXa'</span>, <span class="st">'IXb'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create time definitions ####################</span></span>
<span></span>
<span><span class="va">actions_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/action_time.html">g3a_time</a></span><span class="op">(</span></span>
<span>    <span class="fl">1979L</span>, <span class="fl">2023L</span>,</span>
<span>    step_lengths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3L</span>, <span class="fl">3L</span>, <span class="fl">3L</span>, <span class="fl">3L</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="va">actions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">actions</span>, <span class="va">actions_time</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="stocks">Stocks<a class="anchor" aria-label="anchor" href="#stocks"></a>
</h3>
<p>We define 2 stocks instead of one, and a <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code>
containing both for convenience:</p>
<div class="modelScript">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create stock definition for fish ####################</span></span>
<span><span class="va">st_imm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stock.html">g3_stock</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>species <span class="op">=</span> <span class="st">"fish"</span>, <span class="st">'imm'</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">5L</span>, <span class="fl">25L</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/stock_areas.html">g3s_livesonareas</a></span><span class="op">(</span><span class="va">area_names</span><span class="op">[</span><span class="st">"IXa"</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/stock_age.html">g3s_age</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">5L</span><span class="op">)</span></span>
<span></span>
<span><span class="va">st_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stock.html">g3_stock</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>species <span class="op">=</span> <span class="st">"fish"</span>, <span class="st">'mat'</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">5L</span>, <span class="fl">25L</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/stock_areas.html">g3s_livesonareas</a></span><span class="op">(</span><span class="va">area_names</span><span class="op">[</span><span class="st">"IXa"</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/stock_age.html">g3s_age</a></span><span class="op">(</span><span class="fl">3L</span>, <span class="fl">10L</span><span class="op">)</span></span>
<span><span class="va">stocks</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>imm <span class="op">=</span> <span class="va">st_imm</span>, mat <span class="op">=</span> <span class="va">st_mat</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Notice that:</p>
<ul>
<li>The name of the stock has 2 parts. This makes it possible to have
parameters that refer to the species as a whole. In the model output the
names will have been combined, e.g. <code>"fish_imm"</code>.</li>
<li>The age ranges are not identical, obviously mature stocks are older,
and we adjust to suit.</li>
</ul>
</div>
<div class="section level3">
<h3 id="stock-actions">Stock actions<a class="anchor" aria-label="anchor" href="#stock-actions"></a>
</h3>
<p>Stock actions now need to include interactions between immature &amp;
mature:</p>
<div class="modelScript">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">actions_st_imm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/action_grow.html">g3a_growmature</a></span><span class="op">(</span><span class="va">st_imm</span>,</span>
<span>    <span class="fu"><a href="../reference/action_grow.html">g3a_grow_impl_bbinom</a></span><span class="op">(</span></span>
<span>      maxlengthgroupgrowth <span class="op">=</span> <span class="fl">4L</span> <span class="op">)</span>,</span>
<span>    <span class="co"># Add maturation</span></span>
<span>    maturity_f <span class="op">=</span> <span class="fu"><a href="../reference/action_mature.html">g3a_mature_continuous</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    output_stocks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">st_mat</span><span class="op">)</span>,</span>
<span>    transition_f <span class="op">=</span> <span class="op">~</span><span class="cn">TRUE</span> <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/action_naturalmortality.html">g3a_naturalmortality</a></span><span class="op">(</span><span class="va">st_imm</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/action_renewal.html">g3a_initialconditions_normalcv</a></span><span class="op">(</span><span class="va">st_imm</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/action_renewal.html">g3a_renewal_normalparam</a></span><span class="op">(</span><span class="va">st_imm</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/action_age.html">g3a_age</a></span><span class="op">(</span><span class="va">st_imm</span>, output_stocks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">st_mat</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="va">actions_st_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/action_grow.html">g3a_growmature</a></span><span class="op">(</span><span class="va">st_mat</span>,</span>
<span>    <span class="fu"><a href="../reference/action_grow.html">g3a_grow_impl_bbinom</a></span><span class="op">(</span></span>
<span>      maxlengthgroupgrowth <span class="op">=</span> <span class="fl">4L</span> <span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/action_naturalmortality.html">g3a_naturalmortality</a></span><span class="op">(</span><span class="va">st_mat</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/action_renewal.html">g3a_initialconditions_normalcv</a></span><span class="op">(</span><span class="va">st_mat</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/action_age.html">g3a_age</a></span><span class="op">(</span><span class="va">st_mat</span><span class="op">)</span>,</span>
<span>  <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="va">actions_likelihood_st</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/likelihood_understocking.html">g3l_understocking</a></span><span class="op">(</span><span class="va">stocks</span>, nll_breakdown <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="va">actions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">actions</span>, <span class="va">actions_st_imm</span>, <span class="va">actions_st_mat</span>, <span class="va">actions_likelihood_st</span><span class="op">)</span></span></code></pre></div>
</div>
<p><code>actions_st_imm</code> and <code>actions_st_imm</code> are
largely similar to our <code>actions_fish</code> from the previous
model, but:</p>
<ul>
<li>We have added a <code>maturity_f</code> to
<code><a href="../reference/action_grow.html">g3a_growmature()</a></code> to move individuals to the mature stock.
The rate of maturity is coupled to growth, which is why
<code><a href="../reference/action_grow.html">g3a_growmature()</a></code> does both at the same time.</li>
<li>Immature <code><a href="../reference/action_age.html">g3a_age()</a></code> can also move individuals to the
mature stock. This will happen if an immature fish ages beyond the final
age bin (5 in our case). At that point it matures “by default”.</li>
<li>Mature has no <code><a href="../reference/action_renewal.html">g3a_renewal_normalparam()</a></code>, as there is no
recruitment directly into the mature stock.</li>
</ul>
</div>
<div class="section level3">
<h3 id="fleet-actions">Fleet actions<a class="anchor" aria-label="anchor" href="#fleet-actions"></a>
</h3>
<p>There is very little difference defining a fleet for a multiple stock
model vs. single stocks.</p>
<p>To define a fleet, we need to introduce historical data into the
model. In our case we will generate random data to use later:</p>
<div class="modelScript">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fleet data for f_surv #################################</span></span>
<span></span>
<span><span class="co"># Landings data: For each year/step/area</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">1990</span><span class="op">:</span><span class="fl">1994</span>, step <span class="op">=</span> <span class="fl">2</span>, area <span class="op">=</span> <span class="st">'IXa'</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="co"># Generate a random total landings by weight</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, mean <span class="op">=</span> <span class="fl">1000</span>, sd <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="co"># Assign result to landings_f_surv</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/identity.html" class="external-link">identity</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">landings_f_surv</span></span>
<span></span>
<span><span class="co"># Length distribution data: Generate 100 random samples in each year/step/area</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">1990</span><span class="op">:</span><span class="fl">1994</span>, step <span class="op">=</span> <span class="fl">2</span>, area <span class="op">=</span> <span class="st">'IXa'</span>, length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Generate random lengths for these samples</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, mean <span class="op">=</span> <span class="fl">50</span>, sd <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Save unagggregated data into ldist_f_surv.raw</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/identity.html" class="external-link">identity</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">ldist_f_surv.raw</span></span>
<span></span>
<span><span class="co"># Aggregate .raw data</span></span>
<span><span class="va">ldist_f_surv.raw</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Group into length bins</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span></span>
<span>      year <span class="op">=</span> <span class="va">year</span>,</span>
<span>      step <span class="op">=</span> <span class="va">step</span>,</span>
<span>      length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">length</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">80</span>, <span class="fl">20</span><span class="op">)</span>, <span class="cn">Inf</span><span class="op">)</span>, right <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Report count in each length bin</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>number <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">'keep'</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Save into ldist_f_surv</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/identity.html" class="external-link">identity</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">ldist_f_surv</span></span>
<span></span>
<span><span class="co"># Assume 5 * 5 samples in each year/step/area</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">1990</span><span class="op">:</span><span class="fl">1994</span>, step <span class="op">=</span> <span class="fl">2</span>, area <span class="op">=</span> <span class="st">'IXa'</span>, age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">5</span><span class="op">)</span>, length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Generate random lengths/ages for these samples</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, mean <span class="op">=</span> <span class="fl">50</span>, sd <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Generate random whole numbers for age</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, min <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Group into length/age bins</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span></span>
<span>      year <span class="op">=</span> <span class="va">year</span>,</span>
<span>      step <span class="op">=</span> <span class="va">step</span>,</span>
<span>      age <span class="op">=</span> <span class="va">age</span>,</span>
<span>      length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">length</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">80</span>, <span class="fl">20</span><span class="op">)</span>, <span class="cn">Inf</span><span class="op">)</span>, right <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Report count in each length bin</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>number <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">'keep'</span><span class="op">)</span> <span class="op">-&gt;</span></span>
<span>  <span class="va">aldist_f_surv</span></span></code></pre></div>
</div>
<p>For more information on how this works, see
<code><a href="../articles/incorporating-observation-data.html">vignette("incorporating-observation-data")</a></code>.</p>
<p>Our fleet is defined with the same set of actions as the
single-species model:</p>
<div class="modelScript">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create fleet definition for f_surv ####################</span></span>
<span><span class="va">f_surv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stock.html">g3_fleet</a></span><span class="op">(</span><span class="st">"f_surv"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/stock_areas.html">g3s_livesonareas</a></span><span class="op">(</span><span class="va">area_names</span><span class="op">[</span><span class="st">"IXa"</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">actions_f_surv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/action_predate.html">g3a_predate_fleet</a></span><span class="op">(</span></span>
<span>    <span class="va">f_surv</span>,</span>
<span>    <span class="va">stocks</span>,</span>
<span>    suitabilities <span class="op">=</span> <span class="fu"><a href="../reference/suitability.html">g3_suitability_exponentiall50</a></span><span class="op">(</span>by_stock <span class="op">=</span> <span class="st">'species'</span><span class="op">)</span>,</span>
<span>    catchability_f <span class="op">=</span> <span class="fu"><a href="../reference/action_predate.html">g3a_predate_catchability_totalfleet</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="../reference/timedata.html">g3_timeareadata</a></span><span class="op">(</span><span class="st">"landings_f_surv"</span>, <span class="va">landings_f_surv</span>, <span class="st">"weight"</span>, areas <span class="op">=</span> <span class="va">area_names</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="va">actions_likelihood_f_surv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/likelihood_distribution.html">g3l_catchdistribution</a></span><span class="op">(</span></span>
<span>    <span class="st">"ldist_f_surv"</span>,</span>
<span>    obs_data <span class="op">=</span> <span class="va">ldist_f_surv</span>,</span>
<span>    fleets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">f_surv</span><span class="op">)</span>,</span>
<span>    stocks <span class="op">=</span> <span class="va">stocks</span>,</span>
<span>    function_f <span class="op">=</span> <span class="fu"><a href="../reference/likelihood_distribution.html">g3l_distribution_sumofsquares</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    area_group <span class="op">=</span> <span class="va">area_names</span>,</span>
<span>    report <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    nll_breakdown <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/likelihood_distribution.html">g3l_catchdistribution</a></span><span class="op">(</span></span>
<span>    <span class="st">"aldist_f_surv"</span>,</span>
<span>    obs_data <span class="op">=</span> <span class="va">aldist_f_surv</span>,</span>
<span>    fleets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">f_surv</span><span class="op">)</span>,</span>
<span>    stocks <span class="op">=</span> <span class="va">stocks</span>,</span>
<span>    function_f <span class="op">=</span> <span class="fu"><a href="../reference/likelihood_distribution.html">g3l_distribution_sumofsquares</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    area_group <span class="op">=</span> <span class="va">area_names</span>,</span>
<span>    report <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    nll_breakdown <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="va">actions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">actions</span>, <span class="va">actions_f_surv</span>, <span class="va">actions_likelihood_f_surv</span><span class="op">)</span></span></code></pre></div>
</div>
<p>There are 2 differences to before:</p>
<ul>
<li>All actions use our list <code>stocks</code>, not an individual
stock. Without additional changes, the 2 are treated as a single
combined stock.</li>
<li>We set
<code>g3_suitability_exponentiall50(by_stock = 'species')</code>,
instructing it to have a single <code>alpha</code> &amp;
<code>l50</code> parameter for both our stocks, as they have the same
species name.</li>
</ul>
<p>The <code>by_stock</code> parameter is passed through to
<code><a href="../reference/params.html">g3_parameterized()</a></code>. We can see the result of setting this
in the parameter template. If <code>by_stock = TRUE</code> (the default)
then we get parameters for both <code>fish_imm.f_surv.l50</code> &amp;
<code>fish_mat.f_surv.l50</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simple_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_r.html">g3_to_r</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/action_time.html">g3a_time</a></span><span class="op">(</span><span class="fl">1990</span>, <span class="fl">1994</span><span class="op">)</span>, <span class="fu"><a href="../reference/action_predate.html">g3a_predate_fleet</a></span><span class="op">(</span></span>
<span>    <span class="va">f_surv</span>,</span>
<span>    <span class="va">stocks</span>,</span>
<span>    suitabilities <span class="op">=</span> <span class="fu"><a href="../reference/suitability.html">g3_suitability_exponentiall50</a></span><span class="op">(</span>by_stock <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    catchability_f <span class="op">=</span> <span class="fu"><a href="../reference/action_predate.html">g3a_predate_catchability_totalfleet</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in value[[3L]](cond): Error in get(var_name, envir = env, inherits = TRUE): object 'fish_imm__num' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## g3_with(`:=`(catchability, (suitability * fish_imm__num[, fish_imm__area_idx, fish_imm__age_idx] * fish_imm__wgt[, fish_imm__area_idx, fish_imm__age_idx])), `:=`(f_surv__area_idx, g3_idx(1L)), `:=`(predator_area, area), {</span></span>
<span><span class="co">## Error in get(var_name, envir = env, inherits = TRUE): object 'fish_imm__num' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## fish_imm__consratio &lt;- fish_imm__totalpredate/avoid_zero(fish_imm__num * fish_imm__wgt)</span></span>
<span><span class="co">## Error in get(var_name, envir = env, inherits = TRUE): object 'fish_imm__num' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## fish_imm__totalpredate &lt;- (fish_imm__num * fish_imm__wgt) * fish_imm__consratio</span></span>
<span><span class="co">## Error in get(var_name, envir = env, inherits = TRUE): object 'fish_imm__num' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## fish_imm__num &lt;- fish_imm__num * (1 - fish_imm__consratio)</span></span></code></pre>
<pre><code><span><span class="co">## Warning in value[[3L]](cond): Error in get(var_name, envir = env, inherits = TRUE): object 'fish_imm__wgt' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## g3_with(`:=`(catchability, (suitability * fish_imm__num[, fish_imm__area_idx, fish_imm__age_idx] * fish_imm__wgt[, fish_imm__area_idx, fish_imm__age_idx])), `:=`(f_surv__area_idx, g3_idx(1L)), `:=`(predator_area, area), {</span></span>
<span><span class="co">## Error in get(var_name, envir = env, inherits = TRUE): object 'fish_imm__wgt' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## fish_imm__consratio &lt;- fish_imm__totalpredate/avoid_zero(fish_imm__num * fish_imm__wgt)</span></span>
<span><span class="co">## Error in get(var_name, envir = env, inherits = TRUE): object 'fish_imm__wgt' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## fish_imm__totalpredate &lt;- (fish_imm__num * fish_imm__wgt) * fish_imm__consratio</span></span></code></pre>
<pre><code><span><span class="co">## Warning in value[[3L]](cond): Error in get(var_name, envir = env, inherits = TRUE): object 'fish_mat__num' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## g3_with(`:=`(catchability, (suitability * fish_mat__num[, fish_mat__area_idx, fish_mat__age_idx] * fish_mat__wgt[, fish_mat__area_idx, fish_mat__age_idx])), `:=`(f_surv__area_idx, g3_idx(1L)), `:=`(predator_area, area), {</span></span>
<span><span class="co">## Error in get(var_name, envir = env, inherits = TRUE): object 'fish_mat__num' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## fish_mat__consratio &lt;- fish_mat__totalpredate/avoid_zero(fish_mat__num * fish_mat__wgt)</span></span>
<span><span class="co">## Error in get(var_name, envir = env, inherits = TRUE): object 'fish_mat__num' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## fish_mat__totalpredate &lt;- (fish_mat__num * fish_mat__wgt) * fish_mat__consratio</span></span>
<span><span class="co">## Error in get(var_name, envir = env, inherits = TRUE): object 'fish_mat__num' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## fish_mat__num &lt;- fish_mat__num * (1 - fish_mat__consratio)</span></span></code></pre>
<pre><code><span><span class="co">## Warning in value[[3L]](cond): Error in get(var_name, envir = env, inherits = TRUE): object 'fish_mat__wgt' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## g3_with(`:=`(catchability, (suitability * fish_mat__num[, fish_mat__area_idx, fish_mat__age_idx] * fish_mat__wgt[, fish_mat__area_idx, fish_mat__age_idx])), `:=`(f_surv__area_idx, g3_idx(1L)), `:=`(predator_area, area), {</span></span>
<span><span class="co">## Error in get(var_name, envir = env, inherits = TRUE): object 'fish_mat__wgt' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## fish_mat__consratio &lt;- fish_mat__totalpredate/avoid_zero(fish_mat__num * fish_mat__wgt)</span></span>
<span><span class="co">## Error in get(var_name, envir = env, inherits = TRUE): object 'fish_mat__wgt' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## fish_mat__totalpredate &lt;- (fish_mat__num * fish_mat__wgt) * fish_mat__consratio</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">simple_model</span>, <span class="st">"parameter_template"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "retro_years"           "fish_imm.f_surv.alpha" "fish_imm.f_surv.l50"  </span></span>
<span><span class="co">## [4] "fish_mat.f_surv.alpha" "fish_mat.f_surv.l50"   "project_years"</span></span></code></pre>
<p>If <code>by_stock = 'species'</code>, then there is a single, shared
<code>fish.f_surv.l50</code> parameter:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simple_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_r.html">g3_to_r</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/action_time.html">g3a_time</a></span><span class="op">(</span><span class="fl">1990</span>, <span class="fl">1994</span><span class="op">)</span>, <span class="fu"><a href="../reference/action_predate.html">g3a_predate_fleet</a></span><span class="op">(</span></span>
<span>    <span class="va">f_surv</span>,</span>
<span>    <span class="va">stocks</span>,</span>
<span>    suitabilities <span class="op">=</span> <span class="fu"><a href="../reference/suitability.html">g3_suitability_exponentiall50</a></span><span class="op">(</span>by_stock <span class="op">=</span> <span class="st">'species'</span><span class="op">)</span>,</span>
<span>    catchability_f <span class="op">=</span> <span class="fu"><a href="../reference/action_predate.html">g3a_predate_catchability_totalfleet</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in value[[3L]](cond): Error in get(var_name, envir = env, inherits = TRUE): object 'fish_imm__num' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## g3_with(`:=`(catchability, (suitability * fish_imm__num[, fish_imm__area_idx, fish_imm__age_idx] * fish_imm__wgt[, fish_imm__area_idx, fish_imm__age_idx])), `:=`(f_surv__area_idx, g3_idx(1L)), `:=`(predator_area, area), {</span></span>
<span><span class="co">## Error in get(var_name, envir = env, inherits = TRUE): object 'fish_imm__num' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## fish_imm__consratio &lt;- fish_imm__totalpredate/avoid_zero(fish_imm__num * fish_imm__wgt)</span></span>
<span><span class="co">## Error in get(var_name, envir = env, inherits = TRUE): object 'fish_imm__num' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## fish_imm__totalpredate &lt;- (fish_imm__num * fish_imm__wgt) * fish_imm__consratio</span></span>
<span><span class="co">## Error in get(var_name, envir = env, inherits = TRUE): object 'fish_imm__num' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## fish_imm__num &lt;- fish_imm__num * (1 - fish_imm__consratio)</span></span></code></pre>
<pre><code><span><span class="co">## Warning in value[[3L]](cond): Error in get(var_name, envir = env, inherits = TRUE): object 'fish_imm__wgt' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## g3_with(`:=`(catchability, (suitability * fish_imm__num[, fish_imm__area_idx, fish_imm__age_idx] * fish_imm__wgt[, fish_imm__area_idx, fish_imm__age_idx])), `:=`(f_surv__area_idx, g3_idx(1L)), `:=`(predator_area, area), {</span></span>
<span><span class="co">## Error in get(var_name, envir = env, inherits = TRUE): object 'fish_imm__wgt' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## fish_imm__consratio &lt;- fish_imm__totalpredate/avoid_zero(fish_imm__num * fish_imm__wgt)</span></span>
<span><span class="co">## Error in get(var_name, envir = env, inherits = TRUE): object 'fish_imm__wgt' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## fish_imm__totalpredate &lt;- (fish_imm__num * fish_imm__wgt) * fish_imm__consratio</span></span></code></pre>
<pre><code><span><span class="co">## Warning in value[[3L]](cond): Error in get(var_name, envir = env, inherits = TRUE): object 'fish_mat__num' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## g3_with(`:=`(catchability, (suitability * fish_mat__num[, fish_mat__area_idx, fish_mat__age_idx] * fish_mat__wgt[, fish_mat__area_idx, fish_mat__age_idx])), `:=`(f_surv__area_idx, g3_idx(1L)), `:=`(predator_area, area), {</span></span>
<span><span class="co">## Error in get(var_name, envir = env, inherits = TRUE): object 'fish_mat__num' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## fish_mat__consratio &lt;- fish_mat__totalpredate/avoid_zero(fish_mat__num * fish_mat__wgt)</span></span>
<span><span class="co">## Error in get(var_name, envir = env, inherits = TRUE): object 'fish_mat__num' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## fish_mat__totalpredate &lt;- (fish_mat__num * fish_mat__wgt) * fish_mat__consratio</span></span>
<span><span class="co">## Error in get(var_name, envir = env, inherits = TRUE): object 'fish_mat__num' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## fish_mat__num &lt;- fish_mat__num * (1 - fish_mat__consratio)</span></span></code></pre>
<pre><code><span><span class="co">## Warning in value[[3L]](cond): Error in get(var_name, envir = env, inherits = TRUE): object 'fish_mat__wgt' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## g3_with(`:=`(catchability, (suitability * fish_mat__num[, fish_mat__area_idx, fish_mat__age_idx] * fish_mat__wgt[, fish_mat__area_idx, fish_mat__age_idx])), `:=`(f_surv__area_idx, g3_idx(1L)), `:=`(predator_area, area), {</span></span>
<span><span class="co">## Error in get(var_name, envir = env, inherits = TRUE): object 'fish_mat__wgt' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## fish_mat__consratio &lt;- fish_mat__totalpredate/avoid_zero(fish_mat__num * fish_mat__wgt)</span></span>
<span><span class="co">## Error in get(var_name, envir = env, inherits = TRUE): object 'fish_mat__wgt' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## fish_mat__totalpredate &lt;- (fish_mat__num * fish_mat__wgt) * fish_mat__consratio</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">simple_model</span>, <span class="st">"parameter_template"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "retro_years"       "fish.f_surv.alpha" "fish.f_surv.l50"  </span></span>
<span><span class="co">## [4] "project_years"</span></span></code></pre>
<p>The <code>by_stock</code> parameter is just a convenient shortcut to
change the default settings, if we specify
<code><a href="../reference/params.html">g3_parameterized()</a></code> ourselves we can change the
parameterization in other ways, for example <code>by_year = TRUE</code>
gives us per-year <code>l50</code>:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simple_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_r.html">g3_to_r</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/action_time.html">g3a_time</a></span><span class="op">(</span><span class="fl">1990</span>, <span class="fl">1994</span><span class="op">)</span>, <span class="fu"><a href="../reference/action_predate.html">g3a_predate_fleet</a></span><span class="op">(</span></span>
<span>    <span class="va">f_surv</span>,</span>
<span>    <span class="va">stocks</span>,</span>
<span>    suitabilities <span class="op">=</span> <span class="fu"><a href="../reference/suitability.html">g3_suitability_exponentiall50</a></span><span class="op">(</span></span>
<span>        l50 <span class="op">=</span> <span class="fu"><a href="../reference/params.html">g3_parameterized</a></span><span class="op">(</span><span class="st">"l50"</span>, by_stock <span class="op">=</span> <span class="st">'species'</span>, by_predator <span class="op">=</span> <span class="cn">TRUE</span>, by_year <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    catchability_f <span class="op">=</span> <span class="fu"><a href="../reference/action_predate.html">g3a_predate_catchability_totalfleet</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in value[[3L]](cond): Error in get(var_name, envir = env, inherits = TRUE): object 'fish_imm__num' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## g3_with(`:=`(catchability, (suitability * fish_imm__num[, fish_imm__area_idx, fish_imm__age_idx] * fish_imm__wgt[, fish_imm__area_idx, fish_imm__age_idx])), `:=`(f_surv__area_idx, g3_idx(1L)), `:=`(predator_area, area), {</span></span>
<span><span class="co">## Error in get(var_name, envir = env, inherits = TRUE): object 'fish_imm__num' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## fish_imm__consratio &lt;- fish_imm__totalpredate/avoid_zero(fish_imm__num * fish_imm__wgt)</span></span>
<span><span class="co">## Error in get(var_name, envir = env, inherits = TRUE): object 'fish_imm__num' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## fish_imm__totalpredate &lt;- (fish_imm__num * fish_imm__wgt) * fish_imm__consratio</span></span>
<span><span class="co">## Error in get(var_name, envir = env, inherits = TRUE): object 'fish_imm__num' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## fish_imm__num &lt;- fish_imm__num * (1 - fish_imm__consratio)</span></span></code></pre>
<pre><code><span><span class="co">## Warning in value[[3L]](cond): Error in get(var_name, envir = env, inherits = TRUE): object 'fish_imm__wgt' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## g3_with(`:=`(catchability, (suitability * fish_imm__num[, fish_imm__area_idx, fish_imm__age_idx] * fish_imm__wgt[, fish_imm__area_idx, fish_imm__age_idx])), `:=`(f_surv__area_idx, g3_idx(1L)), `:=`(predator_area, area), {</span></span>
<span><span class="co">## Error in get(var_name, envir = env, inherits = TRUE): object 'fish_imm__wgt' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## fish_imm__consratio &lt;- fish_imm__totalpredate/avoid_zero(fish_imm__num * fish_imm__wgt)</span></span>
<span><span class="co">## Error in get(var_name, envir = env, inherits = TRUE): object 'fish_imm__wgt' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## fish_imm__totalpredate &lt;- (fish_imm__num * fish_imm__wgt) * fish_imm__consratio</span></span></code></pre>
<pre><code><span><span class="co">## Warning in value[[3L]](cond): Error in get(var_name, envir = env, inherits = TRUE): object 'fish_mat__num' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## g3_with(`:=`(catchability, (suitability * fish_mat__num[, fish_mat__area_idx, fish_mat__age_idx] * fish_mat__wgt[, fish_mat__area_idx, fish_mat__age_idx])), `:=`(f_surv__area_idx, g3_idx(1L)), `:=`(predator_area, area), {</span></span>
<span><span class="co">## Error in get(var_name, envir = env, inherits = TRUE): object 'fish_mat__num' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## fish_mat__consratio &lt;- fish_mat__totalpredate/avoid_zero(fish_mat__num * fish_mat__wgt)</span></span>
<span><span class="co">## Error in get(var_name, envir = env, inherits = TRUE): object 'fish_mat__num' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## fish_mat__totalpredate &lt;- (fish_mat__num * fish_mat__wgt) * fish_mat__consratio</span></span>
<span><span class="co">## Error in get(var_name, envir = env, inherits = TRUE): object 'fish_mat__num' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## fish_mat__num &lt;- fish_mat__num * (1 - fish_mat__consratio)</span></span></code></pre>
<pre><code><span><span class="co">## Warning in value[[3L]](cond): Error in get(var_name, envir = env, inherits = TRUE): object 'fish_mat__wgt' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## g3_with(`:=`(catchability, (suitability * fish_mat__num[, fish_mat__area_idx, fish_mat__age_idx] * fish_mat__wgt[, fish_mat__area_idx, fish_mat__age_idx])), `:=`(f_surv__area_idx, g3_idx(1L)), `:=`(predator_area, area), {</span></span>
<span><span class="co">## Error in get(var_name, envir = env, inherits = TRUE): object 'fish_mat__wgt' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## fish_mat__consratio &lt;- fish_mat__totalpredate/avoid_zero(fish_mat__num * fish_mat__wgt)</span></span>
<span><span class="co">## Error in get(var_name, envir = env, inherits = TRUE): object 'fish_mat__wgt' not found</span></span>
<span><span class="co">## Used in expression(s):</span></span>
<span><span class="co">## fish_mat__totalpredate &lt;- (fish_mat__num * fish_mat__wgt) * fish_mat__consratio</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">simple_model</span>, <span class="st">"parameter_template"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "retro_years"           "fish_imm.f_surv.alpha" "fish.f_surv.l50.1990" </span></span>
<span><span class="co">## [4] "fish.f_surv.l50.1991"  "fish.f_surv.l50.1992"  "fish.f_surv.l50.1993" </span></span>
<span><span class="co">## [7] "fish.f_surv.l50.1994"  "fish_mat.f_surv.alpha" "project_years"</span></span></code></pre>
<p>See <code>?vignette('model-customisation')</code> for more.</p>
<p>If we had data on the distribution of mature vs. immature, our
observation data could contain a <em>stock</em> column with
<code>fish_imm</code> or <code>fish_mat</code>. See
<code><a href="../articles/incorporating-observation-data.html">vignette("incorporating-observation-data")</a></code>.</p>
<p>Again, further fleets can be added by repeating the code above.</p>
</div>
<div class="section level3">
<h3 id="survey-indices">Survey indices<a class="anchor" aria-label="anchor" href="#survey-indices"></a>
</h3>
<p>Survey indices should be handed the full <code>stocks</code> list,
instead of a single stock, but are otherwise the same as before:</p>
<div class="modelScript">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create abundance index for si_cpue ########################</span></span>
<span></span>
<span><span class="co"># Generate random data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">1990</span><span class="op">:</span><span class="fl">1994</span>, step <span class="op">=</span> <span class="fl">3</span>, area <span class="op">=</span> <span class="st">'IXa'</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="co"># Fill in a weight column with total biomass for the year/step/area combination</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, min <span class="op">=</span> <span class="fl">10000</span>, max <span class="op">=</span> <span class="fl">100000</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span></span>
<span>    <span class="va">dist_si_cpue</span></span>
<span></span>
<span><span class="va">actions_likelihood_si_cpue</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/likelihood_distribution.html">g3l_abundancedistribution</a></span><span class="op">(</span></span>
<span>    <span class="st">"dist_si_cpue"</span>,</span>
<span>    <span class="va">dist_si_cpue</span>,</span>
<span></span>
<span>    stocks <span class="op">=</span> <span class="va">stocks</span>,</span>
<span>    function_f <span class="op">=</span> <span class="fu"><a href="../reference/likelihood_distribution.html">g3l_distribution_surveyindices_log</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="cn">NULL</span>, beta <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    area_group <span class="op">=</span> <span class="va">area_names</span>,</span>
<span>    report <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    nll_breakdown <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="va">actions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">actions</span>, <span class="va">actions_likelihood_si_cpue</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="creating-model-functions-and-parameterization">Creating model functions and Parameterization<a class="anchor" aria-label="anchor" href="#creating-model-functions-and-parameterization"></a>
</h3>
<p>At this point, we are ready to convert our model into code:</p>
<div class="modelScript">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create model objective function ####################</span></span>
<span></span>
<span><span class="va">model_code</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_tmb.html">g3_to_tmb</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">actions</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/action_report.html">g3a_report_detail</a></span><span class="op">(</span><span class="va">actions</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/likelihood_bounds.html">g3l_bounds_penalty</a></span><span class="op">(</span><span class="va">actions</span><span class="op">)</span> <span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Now we should be configuring parameters based on the template.</p>
<p>Thanks to using wildcards in the <code><a href="../reference/init_val.html">g3_init_val()</a></code> calls, a
lot of the parameter settings will work regardless of the model being
single- or multi-stock, so we don’t need to change the initial values
from the previous model:</p>
<div class="modelScript">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Guess l50 / linf based on stock sizes</span></span>
<span><span class="va">estimate_l50</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stock.html">g3_stock_def</a></span><span class="op">(</span><span class="va">st_imm</span>, <span class="st">"midlen"</span><span class="op">)</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="../reference/stock.html">g3_stock_def</a></span><span class="op">(</span><span class="va">st_imm</span>, <span class="st">"midlen"</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">estimate_linf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="../reference/stock.html">g3_stock_def</a></span><span class="op">(</span><span class="va">st_imm</span>, <span class="st">"midlen"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">estimate_t0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stock.html">g3_stock_def</a></span><span class="op">(</span><span class="va">st_imm</span>, <span class="st">"minage"</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.8</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">model_code</span>, <span class="st">"parameter_template"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/init_val.html">g3_init_val</a></span><span class="op">(</span><span class="st">"*.rec|init.scalar"</span>, <span class="fl">10</span>, lower <span class="op">=</span> <span class="fl">0.001</span>, upper <span class="op">=</span> <span class="fl">200</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/init_val.html">g3_init_val</a></span><span class="op">(</span><span class="st">"*.init.#"</span>, <span class="fl">10</span>, lower <span class="op">=</span> <span class="fl">0.001</span>, upper <span class="op">=</span> <span class="fl">200</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/init_val.html">g3_init_val</a></span><span class="op">(</span><span class="st">"*.rec.#"</span>, <span class="fl">100</span>, lower <span class="op">=</span> <span class="fl">1e-6</span>, upper <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/init_val.html">g3_init_val</a></span><span class="op">(</span><span class="st">"*.rec.sd"</span>, <span class="fl">5</span>, lower <span class="op">=</span> <span class="fl">4</span>, upper <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/init_val.html">g3_init_val</a></span><span class="op">(</span><span class="st">"*.M.#"</span>, <span class="fl">0.15</span>, lower <span class="op">=</span> <span class="fl">0.001</span>, upper <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/init_val.html">g3_init_val</a></span><span class="op">(</span><span class="st">"init.F"</span>, <span class="fl">0.5</span>, lower <span class="op">=</span> <span class="fl">0.1</span>, upper <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/init_val.html">g3_init_val</a></span><span class="op">(</span><span class="st">"*.Linf"</span>, <span class="va">estimate_linf</span>, spread <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/init_val.html">g3_init_val</a></span><span class="op">(</span><span class="st">"*.K"</span>, <span class="fl">0.3</span>, lower <span class="op">=</span> <span class="fl">0.04</span>, upper <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/init_val.html">g3_init_val</a></span><span class="op">(</span><span class="st">"*.t0"</span>, <span class="va">estimate_t0</span>, spread <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/init_val.html">g3_init_val</a></span><span class="op">(</span><span class="st">"*.walpha"</span>, <span class="fl">0.01</span>, optimise <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/init_val.html">g3_init_val</a></span><span class="op">(</span><span class="st">"*.wbeta"</span>, <span class="fl">3</span>, optimise <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/init_val.html">g3_init_val</a></span><span class="op">(</span><span class="st">"*.*.alpha"</span>, <span class="fl">0.07</span>, lower <span class="op">=</span> <span class="fl">0.01</span>, upper <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/init_val.html">g3_init_val</a></span><span class="op">(</span><span class="st">"*.*.l50"</span>, <span class="va">estimate_l50</span>, spread <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/init_val.html">g3_init_val</a></span><span class="op">(</span><span class="st">"*.bbin"</span>, <span class="fl">100</span>, lower <span class="op">=</span> <span class="fl">1e-05</span>, upper <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/identity.html" class="external-link">identity</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">params.in</span></span></code></pre></div>
</div>
<p>Finally we are ready for optimisation runs.
<code><a href="../reference/run_tmb.html">g3_tmb_adfun()</a></code> is a wrapper around
<code><a href="https://rdrr.io/pkg/TMB/man/MakeADFun.html" class="external-link">TMB::MakeADFun()</a></code> and <code><a href="https://rdrr.io/pkg/TMB/man/compile.html" class="external-link">TMB::compile</a></code>, producing a
TMB <em>objective function</em>.
<code>gadgetutils::g3_iterative()</code> then optimises based on
iterative reweighting</p>
<div class="modelScript">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Optimise model ################################</span></span>
<span><span class="va">obj.fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_tmb.html">g3_tmb_adfun</a></span><span class="op">(</span><span class="va">model_code</span>, <span class="va">params.in</span><span class="op">)</span></span>
<span></span>
<span><span class="va">params.out</span> <span class="op">&lt;-</span> <span class="fu">gadgetutils</span><span class="fu">::</span><span class="fu">g3_iterative</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    wgts <span class="op">=</span> <span class="st">"WGTS"</span>,</span>
<span>    model <span class="op">=</span> <span class="va">model_code</span>,</span>
<span>    params.in <span class="op">=</span> <span class="va">params.in</span>,</span>
<span>    grouping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        fleet <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ldist_f_surv"</span>, <span class="st">"aldist_f_surv"</span><span class="op">)</span>,</span>
<span>        abund <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dist_si_cpue"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"BFGS"</span>,</span>
<span>    control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxit <span class="op">=</span> <span class="fl">1000</span>, reltol <span class="op">=</span> <span class="fl">1e-10</span><span class="op">)</span>,</span>
<span>    cv_floor <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Once this has finished, we can view the output using
<code>gadgetplots::gadget_plots()</code>.</p>
<div class="modelScript">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate detailed report ######################</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">gadgetutils</span><span class="fu">::</span><span class="fu">g3_fit</span><span class="op">(</span><span class="va">model_code</span>, <span class="va">params.out</span><span class="op">)</span></span>
<span><span class="fu">gadgetplots</span><span class="fu">::</span><span class="fu">gadget_plots</span><span class="op">(</span><span class="va">fit</span>, <span class="st">"figs"</span>, file_type <span class="op">=</span> <span class="st">"html"</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Once finished, you can view the output in your web browser:</p>
<div class="modelScript">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/browseURL.html" class="external-link">browseURL</a></span><span class="op">(</span><span class="st">"figs/model_output_figures.html"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="appendix-full-model-script">Appendix: Full model script<a class="anchor" aria-label="anchor" href="#appendix-full-model-script"></a>
</h2>
<p>For convenience, here is all the sections of the model script above
joined together:</p>
<script>
document.write(
    '<div class="modelScript"><div class="sourceCode hasCopyButton"><pre class="downlit sourceCode r">' +
    Array.from(document.querySelectorAll('.modelScript pre')).map((x) => x.innerHTML).join("\n\n") +
    '</pre></div></div>');
</script>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jamie Lentin, Bjarki Thor Elvarsson, William Butler.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
