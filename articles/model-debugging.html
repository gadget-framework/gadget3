<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Debugging a gadget3 model • gadget3</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<script src="../extra.js"></script><meta property="og:title" content="Debugging a gadget3 model">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gadget3</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.14-0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction-single-stock.html">Introduction to gadget3: A single stock model</a>
    </li>
    <li>
      <a href="../articles/incorporating-observation-data.html">Incorporating observation data into models</a>
    </li>
    <li>
      <a href="../articles/multiple-substocks.html">Modelling maturity &amp; sex with multiple stocks</a>
    </li>
    <li>
      <a href="../articles/model-customisation.html">Model customisation</a>
    </li>
    <li>
      <a href="../articles/random-effect-recruitment.html">Random effects &amp; projections</a>
    </li>
    <li>
      <a href="../articles/model-debugging.html">Debugging a gadget3 model</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Advanced</li>
    <li>
      <a href="../articles/model-structure.html">Structure of a gadget3 model</a>
    </li>
    <li>
      <a href="../articles/writing_actions.html">Writing G3 Actions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/gadget-framework/gadget3/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Debugging a gadget3 model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/gadget-framework/gadget3/blob/v0.14-0/vignettes/model-debugging.Rmd" class="external-link"><code>vignettes/model-debugging.Rmd</code></a></small>
      <div class="hidden name"><code>model-debugging.Rmd</code></div>

    </div>

    
    
<p>There are several techniques available to help debug problems in
gadget3 models. The following lists common errors and ways you can
investigate further.</p>
<div class="section level2">
<h2 id="viewing-editing-model-code">Viewing &amp; editing model code<a class="anchor" aria-label="anchor" href="#viewing-editing-model-code"></a>
</h2>
<p>gadget3 models are converted to R or TMB source code, which is often
useful to study to see what the model will do at any point. It is also
possible to edit the source code and e.g. add debugging breaks with
<code><a href="https://rdrr.io/r/utils/recover.html" class="external-link">recover()</a></code>.</p>
<p>An R model function can be viewed / edited directly using the R
<code><a href="https://rdrr.io/r/utils/edit.html" class="external-link">edit()</a></code> function:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create model based on your actions</span></span>
<span><span class="va">model_fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_r.html">g3_to_r</a></span><span class="op">(</span><span class="va">actions</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Edit source code &amp; re-run model</span></span>
<span><span class="va">model_fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/edit.html" class="external-link">edit</a></span><span class="op">(</span><span class="va">model_fn</span><span class="op">)</span></span>
<span><span class="fu">model_fn</span><span class="op">(</span><span class="va">params.in</span><span class="op">)</span></span></code></pre></div>
<p>The TMB source code could also be inspected using
<code><a href="https://rdrr.io/r/utils/edit.html" class="external-link">edit()</a></code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmb_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_tmb.html">g3_to_tmb</a></span><span class="op">(</span><span class="va">actions</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Edit source code &amp; re-run model</span></span>
<span><span class="va">tmb_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/edit.html" class="external-link">edit</a></span><span class="op">(</span><span class="va">tmb_model</span><span class="op">)</span></span>
<span><span class="va">obj.fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_tmb.html">g3_tmb_adfun</a></span><span class="op">(</span><span class="va">tmb_model</span>, <span class="va">params.in</span>, type <span class="op">=</span> <span class="st">"Fun"</span><span class="op">)</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="va">obj.fn</span><span class="op">$</span><span class="fu">report</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>As the R &amp; TMB model will be equivalent, you can view the source
of whichever you are more comfortable with.</p>
</div>
<div class="section level2">
<h2 id="nan-in-likelihood-reports">
<code>NaN</code> in likelihood / reports<a class="anchor" aria-label="anchor" href="#nan-in-likelihood-reports"></a>
</h2>
<p>A non-finite value, once generated, will spread to all related parts
of the model, so trying to debug by looking at the final result is often
useless.</p>
<p>To pinpoint where the problem is, you can add
<code><a href="../reference/action_trace.html">g3a_trace_var()</a></code> to find where the problem originates. See
the manpage for how to use it.</p>
<div class="section level3">
<h3 id="error-in-optim-initial-value-in-vmmin-is-not-finite">“Error in optim(…): initial value in ‘vmmin’ is not finite”<a class="anchor" aria-label="anchor" href="#error-in-optim-initial-value-in-vmmin-is-not-finite"></a>
</h3>
<p>The optimiser is telling you that the initial values you provided do
not produce a finite likelihood. Add <code><a href="../reference/action_trace.html">g3a_trace_var()</a></code> and
run your model outside the optimiser, with e.g:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmb_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_tmb.html">g3_to_tmb</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">actions</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/action_report.html">g3a_report_detail</a></span><span class="op">(</span><span class="va">actions</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/action_trace.html">g3a_trace_var</a></span><span class="op">(</span><span class="va">actions</span><span class="op">)</span>,</span>
<span>  <span class="fu">gadget3</span><span class="fu">::</span><span class="fu"><a href="../reference/likelihood_bounds.html">g3l_bounds_penalty</a></span><span class="op">(</span><span class="va">actions</span><span class="op">)</span> <span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">obj.fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_tmb.html">g3_tmb_adfun</a></span><span class="op">(</span><span class="va">tmb_model</span>, <span class="va">params.in</span>, type <span class="op">=</span> <span class="st">"Fun"</span><span class="op">)</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="va">obj.fn</span><span class="op">$</span><span class="fu">report</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="increasing-objective-function-verbosity">Increasing objective function verbosity<a class="anchor" aria-label="anchor" href="#increasing-objective-function-verbosity"></a>
</h2>
<p>TMB objective functions have several options to increase logging
output</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obj.fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_tmb.html">g3_tmb_adfun</a></span><span class="op">(</span></span>
<span>    <span class="va">model_cpp</span>,</span>
<span>    <span class="va">params.in</span>,</span>
<span>    <span class="co"># control allows you to tweak trace level for outer optimiser, see "?stats::optim"</span></span>
<span>    control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>trace <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>    <span class="co"># inner.control allows you to increase trace level for the random effect optimiser, see "?TMB::newton"</span></span>
<span>    inner.control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>trace <span class="op">=</span> <span class="fl">3</span>, maxit <span class="op">=</span> <span class="fl">1000</span>, tol <span class="op">=</span> <span class="fl">1e-7</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">obj.fn</span><span class="op">$</span><span class="va">env</span><span class="op">$</span><span class="va">tracepar</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>  <span class="co"># Print result of every likelihood evaluation</span></span>
<span><span class="va">obj.fn</span><span class="op">$</span><span class="va">env</span><span class="op">$</span><span class="va">tracemgc</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>  <span class="co"># Print maximum gradient at every gradient evaluation</span></span>
<span><span class="va">obj.fn</span><span class="op">$</span><span class="va">env</span><span class="op">$</span><span class="va">silent</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span>  <span class="co"># Show/hide tracing messages</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="tmb-model-crashes-your-r-session">TMB model crashes your R session<a class="anchor" aria-label="anchor" href="#tmb-model-crashes-your-r-session"></a>
</h2>
<p>If the model crashes whilst forming the TMB ADFun object, then it
takes your R session with it. If this is happening, wrap
<code><a href="../reference/run_tmb.html">g3_tmb_adfun()</a></code> with <code><a href="https://rdrr.io/pkg/TMB/man/gdbsource.html" class="external-link">TMB::gdbsource()</a></code> as
follows:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Model setup will look something like this</span></span>
<span><span class="va">tmb_ling</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_tmb.html">g3_to_tmb</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span><span class="va">tmb_param</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">tmb_ling</span>, <span class="st">'parameter_template'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="fu">TMB</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/TMB/man/gdbsource.html" class="external-link">gdbsource</a></span><span class="op">(</span><span class="fu"><a href="../reference/run_tmb.html">g3_tmb_adfun</a></span><span class="op">(</span></span>
<span>    <span class="va">tmb_ling</span>,</span>
<span>    <span class="va">tmb_param</span>,</span>
<span>    compile_flags <span class="op">=</span> <span class="st">"-g"</span>,</span>
<span>    output_script <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><code>output_script = TRUE</code> tells <code><a href="../reference/run_tmb.html">g3_tmb_adfun()</a></code>
to, after compilation, write a temporary R script that will build the
TMB ADFun object (and presumably crash in the process).
<code><a href="https://rdrr.io/pkg/TMB/man/gdbsource.html" class="external-link">TMB::gdbsource()</a></code> in turn runs a provided R script in a
fresh R session wrapped in gdb. By default it will print a stacktrace
and quit.</p>
<p>In the stacktrace you should see a line number for where the crash
occured. You can then look at the TMB model source code, find the line
number and thus the action that is currently failing.</p>
</div>
<div class="section level2">
<h2 id="interactive-debugging-of-tmb-models">Interactive debugging of TMB models<a class="anchor" aria-label="anchor" href="#interactive-debugging-of-tmb-models"></a>
</h2>
<p>In theory you can use <code>interactive = TRUE</code> with
<code><a href="https://rdrr.io/pkg/TMB/man/gdbsource.html" class="external-link">TMB::gdbsource()</a></code>, however as this eats error messages it’s
better to do this by hand:</p>
<pre><code>&gt; g3_tmb_adfun(tmb_ling, tmb_param, compile_flags = "-g", output_script = TRUE)
[1] "/tmp/RtmpysTVvW/file3da4a6f13a80c.R"

R -d gdb
(gdb) run --vanilla &lt; /tmp/RtmpysTVvW/file3da4a6f13a80c.R
 . . . Compilation, crash at some point . . .
(gdb) up
(gdb) up
(gdb) up
(gdb) call ling_imm__consratio.print()
Array dim: 35 1 8
Array val: -nan -nan -nan -nan
(gdb) call ling_imm__num.print()
Array dim: 35 1 8
Array val: -nan -nan -nan -nan -nan

(gdb) print cur_time
$5 = 0</code></pre>
<ul>
<li>Print the contents of single values with
<code>std::cout &lt;&lt; ling__Linf &lt;&lt; std::endl;</code>
</li>
<li>Use <code>().cols()</code> and <code>().rows()</code> to get the
size of an array expression</li>
<li>Print the contents of array objects with
<code>ling_imm__consratio.print()</code>
</li>
</ul>
<p>Note that for the <code>.print()</code> method to be available for
arrays, it has to be referenced at least once in the model source,
otherwise it won’t be compiled in. Use <code>edit(tmb_ling)</code> to
add it somewhere first.</p>
<div class="section level3">
<h3 id="random-effects">Random effects<a class="anchor" aria-label="anchor" href="#random-effects"></a>
</h3>
<p>Some notes on debugging errors with random effects models.</p>
<div class="section level4">
<h4 id="tracing-inner-model">Tracing inner model<a class="anchor" aria-label="anchor" href="#tracing-inner-model"></a>
</h4>
<p>Control arguments for the inner <code>TMB:::newton()</code> model can
be provided to <code><a href="../reference/run_tmb.html">g3_tmb_adfun()</a></code>, e.g. to add tracing:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obj.fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_tmb.html">g3_tmb_adfun</a></span><span class="op">(</span><span class="va">bounded_code</span>, <span class="va">params.in</span>, inner.control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>trace <span class="op">=</span> <span class="fl">3</span>, maxit <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="logging-messages">Logging messages<a class="anchor" aria-label="anchor" href="#logging-messages"></a>
</h4>
<pre><code>Trying early exit - PD Hess?</code></pre>
<p>Not much improvement to the solution has been found, so TMB checks to
see if the current solution has a <a href="https://en.wikipedia.org/wiki/Second_partial_derivative_test#Functions_of_many_variables" class="external-link">positive-definite
hessian</a>. If yes, we can stop here.</p>
</div>
<div class="section level4">
<h4 id="missing-value-for-m">Missing value for <code>m</code><a class="anchor" aria-label="anchor" href="#missing-value-for-m"></a>
</h4>
<p>The error:</p>
<pre><code>Error in if (m &lt; 0) { : missing value where TRUE/FALSE needed</code></pre>
<p>…comes from TMB’s newton optimiser, and essentially says there is
<code>NaN</code> in the hessian matrix. <code>m</code> in this case is
equivalent to:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">local</a></span><span class="op">(</span><span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu">spHess</span><span class="op">(</span>random <span class="op">=</span> <span class="cn">TRUE</span>, set_tail <span class="op">=</span> <span class="va">random</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">}</span>, envir <span class="op">=</span> <span class="va">obj.fn</span><span class="op">$</span><span class="va">env</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="missing-value-par---parold">Missing value par - parold<a class="anchor" aria-label="anchor" href="#missing-value-par---parold"></a>
</h4>
<pre><code>Error in if (norm(par - parold) &lt; step.tol) { :
  missing value where TRUE/FALSE needed</code></pre>
<p>The <code>par</code> list of parameters to optimise became NaN, for
various reasons, but likely <code>solveCholesky()</code> failed.</p>
</div>
<div class="section level4">
<h4 id="separate-netwton-optimisation">Separate netwton optimisation<a class="anchor" aria-label="anchor" href="#separate-netwton-optimisation"></a>
</h4>
<p>Generally, <code>TMB:::newton()</code> is called from
<code>obj.fn$env$ff</code>. You can extract the arguments provided by
editing this function:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obj.fn</span><span class="op">$</span><span class="va">env</span><span class="op">$</span><span class="va">ff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/edit.html" class="external-link">edit</a></span><span class="op">(</span><span class="va">obj.fn</span><span class="op">$</span><span class="va">env</span><span class="op">$</span><span class="va">ff</span><span class="op">)</span></span></code></pre></div>
<p>Around line 16, add code to extract the arguments provided, e.g:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>        <span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span><span class="st">"newt.args"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">random.start</span><span class="op">)</span>,</span>
<span>            fn <span class="op">=</span> <span class="va">f0</span>, gr <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">f0</span><span class="op">(</span><span class="va">x</span>, order <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, he <span class="op">=</span> <span class="va">H0</span>,</span>
<span>            env <span class="op">=</span> <span class="va">env</span><span class="op">)</span>, <span class="va">inner.control</span><span class="op">)</span>, env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">globalenv</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Then you can perform a single run to extract arguments:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obj.fn</span><span class="op">$</span><span class="fu">fn</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="fu">TMB</span><span class="fu">:::</span><span class="va"><a href="https://rdrr.io/pkg/TMB/man/newton.html" class="external-link">newton</a></span>, <span class="va">newt.args</span><span class="op">)</span></span></code></pre></div>
<p>…or modify the newton function:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">newt</span> <span class="op">&lt;-</span> <span class="fu">TMB</span><span class="fu">:::</span><span class="va"><a href="https://rdrr.io/pkg/TMB/man/newton.html" class="external-link">newton</a></span></span>
<span><span class="va">newt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/edit.html" class="external-link">edit</a></span><span class="op">(</span><span class="va">newt</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">newt</span>, <span class="va">newt.args</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jamie Lentin, Bjarki Thor Elvarsson, William Butler.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
